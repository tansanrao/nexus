# PostgreSQL Configuration for Bulk Sync Operations
# Apply these settings during bulk imports for maximum performance
# WARNING: Some settings sacrifice durability for speed - use only during bulk imports

# WAL and Checkpointing
# Increase WAL size to reduce checkpoint frequency during bulk imports
max_wal_size = '4GB'                    # Default: 1GB
min_wal_size = '1GB'                    # Default: 80MB
checkpoint_timeout = '30min'            # Default: 5min
checkpoint_completion_target = 0.9      # Default: 0.9
wal_compression = 'on'                  # Reduce WAL size

# Memory Settings
# Allocate more memory for maintenance operations (CREATE INDEX, VACUUM, etc.)
maintenance_work_mem = '2GB'            # Default: 64MB
work_mem = '256MB'                      # Default: 4MB
shared_buffers = '4GB'                  # Default: 128MB (requires restart)

# Parallel Query Configuration
# Enable parallel query processing for large table scans
max_worker_processes = 16               # Total workers (requires restart)
max_parallel_workers = 8                # For parallel queries (requires restart)
max_parallel_workers_per_gather = 4     # Per query (requires restart)
parallel_setup_cost = 100               # Default: 1000 (lower = more likely to parallelize)
parallel_tuple_cost = 0.01              # Default: 0.1 (lower = more likely to parallelize)

# Parallel operations
enable_parallel_hash = on               # Enable parallel hash joins
enable_partitionwise_aggregate = on     # Enable parallel aggregates on partitions

# Async Behavior (USE WITH CAUTION - reduces durability)
# Only enable during bulk sync, disable immediately after
# synchronous_commit = 'off'            # ONLY during sync - transactions committed async
# full_page_writes = 'off'              # RISKY - disable only during bulk import

# Autovacuum (disable during bulk import to avoid interference)
# autovacuum = 'off'                    # ONLY during sync - re-enable immediately after

# Connection Settings
max_connections = 100                   # Default: 100

# Logging (optional - useful for debugging)
log_min_duration_statement = 5000       # Log queries slower than 5s
log_checkpoints = on                    # Log checkpoint activity
log_autovacuum_min_duration = 0         # Log all autovacuum activity

# Query Planning
# Encourage use of indexes and parallel scans
random_page_cost = 1.1                  # Default: 4.0 (lower for SSD)
effective_cache_size = '8GB'            # Default: 4GB (adjust based on available RAM)

# Notes:
# 1. Settings marked "requires restart" need PostgreSQL restart to take effect
# 2. Settings can be applied at session level with SET commands (see db_optimizations.rs)
# 3. Always run VACUUM ANALYZE after bulk import
# 4. Always re-enable autovacuum after bulk import
# 5. synchronous_commit=off is safe for bulk imports but not for regular operations
